<%- include('partials/header') %>

<!-- 연차료 상태 스타일 추가 -->
<link rel="stylesheet" href="/css/annual-fee-status.css">

<main class="main-content">
    <div class="container">
        <div class="page-title">
            <h1>등록특허 현황</h1>
            <p>고객번호로 등록된 특허 목록을 조회합니다</p>
        </div>

        <!-- 검색 섹션 -->
        <section class="search-section">
            <form class="search-form" id="searchForm">
                <!-- 고객번호 입력 필드 -->
                <div class="form-group">
                    <label for="customerNumber" class="form-label">고객번호</label>
                    <div class="input-group">
                        <input 
                            type="text" 
                            id="customerNumber" 
                            name="customerNumber" 
                            class="form-input customer-number-input"
                            placeholder="예: 120190612244"
                            maxlength="12"
                            pattern="[0-9]{12}"
                        >
                        <button type="submit" class="btn btn-primary" id="searchBtn">
                            🔍 검색하기
                        </button>
                    </div>
                    <div class="form-hint">12자리 숫자를 입력하세요</div>
                </div>

                <button type="button" class="btn btn-secondary find-customer-btn" id="findCustomerBtn">
                    고객번호 찾기
                </button>
            </form>
        </section>

        <!-- 결과 섹션 -->
        <section class="results-section" id="resultsSection" style="display: none;">
            <div class="results-header">
                <div class="results-info">
                    <div class="info-item">
                        <span class="info-label">조회일자:</span>
                        <span class="info-value" id="resultCurrentDate">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">고객번호:</span>
                        <span class="info-value" id="resultCustomerNumber">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">최종권리자:</span>
                        <span class="info-value" id="resultApplicantName">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">등록특허 수:</span>
                        <span class="info-value" id="resultTotalCount">0</span>건
                    </div>
                </div>
                <div class="action-buttons">
                    <button type="button" class="btn btn-primary" id="renewalRequestBtn">
                        💰 연차료 납부의뢰
                    </button>
                    <button type="button" class="btn btn-secondary" id="exportBtn">
                        📊 엑셀 다운로드
                    </button>
                </div>
            </div>

            <div class="table-container">
                <table class="patent-table" id="patentTable">
                    <thead>
                        <tr>
                            <th>출원번호</th>
                            <th>등록번호</th>
                            <th>출원인</th>
                            <th>출원일</th>
                            <th>등록일</th>
                            <th>발명의명칭</th>
                            <th>청구항수</th>
                            <th>존속기간 만료일</th>
                            <th>등록상태</th>
                            <th>직전년도 납부정보</th>
                            <th>해당 연차료 납부마감일</th>
                            <th>해당연차수</th>
                            <th>해당연차료</th>
                            <th>정상납부/미납</th>
                            <th>추납기간</th>
                            <th>회복기간</th>
                        </tr>
                    </thead>
                    <tbody id="patentTableBody">
                        <!-- 검색 결과가 여기에 표시됩니다 -->
                    </tbody>
                </table>
            </div>

            <!-- 빈 상태 -->
            <div class="empty-state" id="emptyState" style="display: none;">
                <div class="empty-icon">📄</div>
                <div class="empty-title">등록특허가 없습니다</div>
                <div class="empty-description">해당 고객번호로 등록된 특허를 찾을 수 없습니다.</div>
            </div>
        </section>
    </div>
</main>

<%- include('partials/footer') %>

<script>
// 캐시 무효화를 위한 버전 체크
console.log('🔄 납부의뢰 스크립트 로드됨 - 버전: 2025.08.21.v2');
</script>

<!-- 등록특허 검색 기능 및 연차료 계산 기능 -->
<script src="/js/registered.js?v=2025.08.21.v3"></script>

<script>
// 연차료 계산 기능은 외부 스크립트 파일(registered.js)에서 처리됩니다.

// 연차료 납부의뢰 관련 함수들은 외부 스크립트 파일 (registered.js)에서 처리됩니다.

// 고객번호 찾기 버튼 기능
document.addEventListener('DOMContentLoaded', function() {
    const findCustomerBtn = document.getElementById('findCustomerBtn');
    
    if (findCustomerBtn) {
        findCustomerBtn.addEventListener('click', function() {
            openCustomerSearchPopup();
        });
    }
});

function openCustomerSearchPopup() {
    const url = 'https://www.patent.go.kr/smart/jsp/kiponet/mp/mpopenpatinfo/apagtinfo/ReadApAgtInfoInput.do';
    const popupOptions = 'width=1000,height=800,scrollbars=yes,resizable=yes,status=yes,menubar=no,toolbar=no,location=no';
    
    // 팝업창 열기
    const popup = window.open(url, 'customerSearch', popupOptions);
    
    // 팝업창이 블록되었는지 확인
    if (!popup || popup.closed || typeof popup.closed === 'undefined') {
        alert('팝업 창이 차단되었습니다.\n브라우저의 팝업 차단 설정을 확인해주세요.\n\n또는 다음 링크를 직접 열어주세요:\n' + url);
        return;
    }
    
    // 팝업창 중앙 정렬
    if (popup.moveTo) {
        const left = (screen.width - 1000) / 2;
        const top = (screen.height - 800) / 2;
        popup.moveTo(left, top);
    }
    
    // 팝업창 포커스
    popup.focus();
}
</script>